!function(e,n,t){"use strict";function o(e){return this instanceof o?this.init(e):new o(e)}var r={name:"__is_login_sso",value:"1"},i={NOT_SUPPORTED_BROWSER:"not_supported_browser",TIMEOUT:"timeout",FAIL:"fail",LOGIN_REQUIRED:"login_required",ERROR_RESPONSE:"error_response"},s=["line-local.me","line-alpha.me","line-beta.me","line-rc.me","line.me"],a={getItem:function(e){if(!e||!this.hasItem(e))return null;var t=new RegExp("(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*");return unescape(n.cookie.replace(t,"$1"))},removeItem:function(e,t){e&&this.hasItem(e)&&t&&(n.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; domain="+t)},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(n.cookie)}},u={post:function(e,n,t,o){var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.setRequestHeader("Accept","application/json"),r.withCredentials=!0,r.onload=function(){4===r.readyState&&(200===r.status?t(r):o(r))},r.onerror=function(){o(i.FAIL)},r.ontimeout=function(){o(i.TIMEOUT)},r.send(n)},formEncode:function(e){var n="",t=!0;for(var o in e)if(e.hasOwnProperty(o)){var r=o+"="+encodeURIComponent(e[o]);t?t=!1:r="&"+r,n+=r}return n}},p={isOldIE:function(){if(-1!==e.navigator.userAgent.toLowerCase().indexOf("msie")){var n=e.navigator.appVersion.toLowerCase();if(-1!==n.indexOf("msie 6."))return!0;if(-1!==n.indexOf("msie 7."))return!0;if(-1!==n.indexOf("msie 8."))return!0;if(-1!==n.indexOf("msie 9."))return!0}return!1}};String.prototype.endsWith||(String.prototype.endsWith=function(e,n){var t=this.toString();("number"!=typeof n||!isFinite(n)||Math.floor(n)!==n||n>t.length)&&(n=t.length),n-=e.length;var o=t.lastIndexOf(e,n);return-1!==o&&o===n});var c={issueCodeUrl:"https://access.line.me/oauth2/v2.1/api/code"};o.prototype.init=function(e){if(!(e=e||{}).hasOwnProperty("channelId"))throw new Error('"channelId" is required.');for(var n in c)e.hasOwnProperty(n)||(e[n]=c[n]);this.options=e},o.prototype.issueCode=function(e){p.isOldIE()?e.error(i.NOT_SUPPORTED_BROWSER):this._isMaybeLoginSSO()?this._callIssueCodeAPI(e):e.error(i.LOGIN_REQUIRED)},o.prototype._isMaybeLoginSSO=function(){return a.getItem(r.name)===r.value},o.prototype._removeIsLoginSSOCookie=function(){var e=this._getParentDomain();e&&a.removeItem(r.name,"."+e)},o.prototype._getParentDomain=function(){for(var e=location.hostname,n=0;n<s.length;n++){var t=s[n];if(e.endsWith("."+t))return t}return!1},o.prototype._callIssueCodeAPI=function(e){var n=this,t="channelId="+encodeURIComponent(this.options.channelId)+"&"+u.formEncode(e.data);u.post(this.options.issueCodeUrl,t,function(n){var t=JSON.parse(n.responseText);e.success(t)},function(t){var o=JSON.parse(t.responseText);401===t.status?(n._removeIsLoginSSOCookie(),e.error(i.LOGIN_REQUIRED,o)):e.error(i.ERROR_RESPONSE,o)})},e.LineLoginSSO=o,e.LineLoginSSO.ERROR_CODES=i}(window,window.document);